{"version":3,"file":"static/js/171.f3dbd6ff.chunk.js","mappings":"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","sources":["components/uiSegmentControl.js","components/consumptionVsSalary.js","components/uiSelect.js","utils.js"],"sourcesContent":["export const SegmentControl = (props) => {\n  const { data, setActiveCategory, activeCategory } = props;\n\n  return (\n    <div\n      style={{\n        display: \"flex\",\n        flexDirection: \"row\",\n      }}\n    >\n      {data.map((c, i) => {\n        return (\n          <button\n            key={\"button-\" + i}\n            className={\n              (i === 0 ? \"left\" : i === data.length - 1 ? \"right\" : \"middle\") +\n              (c === activeCategory ? \" active\" : \"\")\n            }\n            onClick={() => setActiveCategory(c)}\n          >\n            {c}\n          </button>\n        );\n      })}\n    </div>\n  );\n};\n","import { useEffect, useRef, useState } from \"react\";\nimport * as Plot from \"@observablehq/plot\";\nimport { dataUnitedConsumptionSalaryCategories } from \"../data/data\";\nimport { compactNumber } from \"../utils\";\nimport { SegmentControl } from \"./uiSegmentControl\";\nimport { Select } from \"./uiSelect\";\n\nconst ConsumptionVsSalary = (props) => {\n  const { width, height } = props;\n\n  const containerRef = useRef();\n\n  const [activeCategory, setActiveCategory] = useState(\"Общественное питание\");\n  const [data, setData] = useState(\n    dataUnitedConsumptionSalaryCategories.filter(\n      (elem) => elem.category === activeCategory\n    )\n  );\n  const [chartContainerWidth, setChartContainerWidth] = useState(null);\n\n  const categories = [\n    \"Общественное питание\",\n    \"Продовольствие\",\n    \"Здоровье\",\n    \"Маркетплейсы\",\n    \"Транспорт\",\n    \"Другие категории\",\n    \"Все категории\",\n  ];\n\n  useEffect(() => {\n    const plot = Plot.plot({\n      subtitle:\n        \"Соотношение изменений заработных плат и расходов в муниципальных образованиях в категории «\" +\n        activeCategory +\n        \"»\",\n      width: width,\n      height: height,\n      inset: 40,\n      x: {\n        tickFormat: (d) => compactNumber(d).toLocaleString(\"ru-RU\") + \"%\",\n        label: \"Изменение в расходах\",\n        labelOffset: -8,\n      },\n      y: {\n        tickFormat: (d) => compactNumber(d).toLocaleString(\"ru-RU\") + \"%\",\n        label: \"Изменение в заработке\",\n        ticks: 6,\n      },\n      marks: [\n        Plot.ruleX([0]),\n        Plot.ruleY([0]),\n        Plot.dot(data, {\n          x: \"consDiffPercent\",\n          y: \"salaryDiffPercent\",\n          stroke: (d) =>\n            d.salaryDiffPercent < 0 || d.consDiffPercent < 0\n              ? \"#ee4444\"\n              : \"black\",\n          channels: {\n            territory_name: {\n              label: \"Муниципалитет:\",\n              value: \"territory_name\",\n            },\n            region_name: { label: \"Регион:\", value: \"region_name\" },\n            consDiff: {\n              label: \"Разница в тратах:\",\n              value: (d) =>\n                compactNumber(d.consDiff) +\n                \" ₽\" +\n                \" (\" +\n                Math.round(d.consDiffPercent * 10) / 10 +\n                \"%)\",\n            },\n            salaryDiff: {\n              label: \"Разница в заработке:\",\n              value: (d) =>\n                compactNumber(d.salaryDiff) +\n                \" ₽\" +\n                \" (\" +\n                (Math.round(d.salaryDiffPercent * 10) / 10).toLocaleString(\n                  \"ru-RU\"\n                ) +\n                \"%)\",\n            },\n          },\n          tip: {\n            format: {\n              x: false,\n              y: false,\n            },\n          },\n        }),\n      ],\n    });\n\n    containerRef.current.append(plot);\n    return () => plot.remove();\n  }, [data]);\n\n  useEffect(() => {\n    setData(\n      dataUnitedConsumptionSalaryCategories.filter(\n        (elem) => elem.category === activeCategory\n      )\n    );\n  }, [activeCategory]);\n\n  useEffect(() => {\n    const element = containerRef.current;\n    if (!element) return;\n\n    const resizeObserver = new ResizeObserver((entries) => {\n      for (let entry of entries) {\n        setChartContainerWidth(entry.contentRect.width);\n      }\n    });\n\n    resizeObserver.observe(element);\n\n    // Cleanup the observer when the component unmounts\n    return () => {\n      resizeObserver.disconnect();\n    };\n  }, []);\n\n  return (\n    <div\n      style={{\n        display: \"flex\",\n        flexDirection: \"column\",\n        alignItems: \"center\",\n        rowGap: \"40px\",\n      }}\n    >\n      {chartContainerWidth < 1000 ? (\n        <Select\n          data={categories}\n          setActiveCategory={setActiveCategory}\n          activeCategory={activeCategory}\n        />\n      ) : (\n        <SegmentControl\n          data={categories}\n          setActiveCategory={setActiveCategory}\n          activeCategory={activeCategory}\n        />\n      )}\n      <div ref={containerRef} />\n    </div>\n  );\n};\n\nexport default ConsumptionVsSalary;\n","export const Select = (props) => {\n  const { data, setActiveCategory, activeCategory } = props;\n\n  return (\n    <div>\n      <select\n        defaultValue={activeCategory}\n        onChange={(e) => setActiveCategory(e.target.value)}\n      >\n        {data.map((c, i) => (\n          <option key={\"option-\" + i} value={c}>\n            {c}\n          </option>\n        ))}\n      </select>\n    </div>\n  );\n};\n","import * as d3 from \"d3\";\n\n// Format with compact notation (e.g., 123M)\nexport const compactNumber = (n) =>\n  new Intl.NumberFormat(\"ru-RU\", { notation: \"compact\" }).format(n);\n\n// a simple duck test for projections and GeoJSON\nexport function rewind(duck, simple) {\n  return duck?.stream\n    ? geoRewindProjection(duck, simple)\n    : duck?.type\n    ? geoRewindFeature(duck, simple)\n    : Array.isArray(duck)\n    ? Array.from(duck, (d) => rewind(d, simple))\n    : duck;\n}\n\nconst geoRewindFeature = (feature, simple) =>\n  geoProjectSimple(feature, geoRewindStream(simple));\n\nconst geoRewindProjection = (projection, simple) => {\n  const { stream: normalize } = geoRewindStream(simple);\n  return { stream: (s) => normalize(projection.stream(s)) };\n};\n\nfunction geoRewindStream(simple = true) {\n  const { geoContains, geoArea } = d3;\n\n  let ring, polygon;\n  return d3.geoTransform({\n    polygonStart() {\n      this.stream.polygonStart();\n      polygon = [];\n    },\n    lineStart() {\n      if (polygon) polygon.push((ring = []));\n      else this.stream.lineStart();\n    },\n    lineEnd() {\n      if (!polygon) this.stream.lineEnd();\n    },\n    point(x, y) {\n      if (polygon) ring.push([x, y]);\n      else this.stream.point(x, y);\n    },\n    polygonEnd() {\n      for (let [i, ring] of polygon.entries()) {\n        ring.push(ring[0].slice());\n        if (\n          i\n            ? // a hole must contain the first point of the polygon\n              !geoContains(\n                { type: \"Polygon\", coordinates: [ring] },\n                polygon[0][0]\n              )\n            : polygon[1]\n            ? // the outer ring must contain the first point of its first hole (if any)\n              !geoContains(\n                { type: \"Polygon\", coordinates: [ring] },\n                polygon[1][0]\n              )\n            : // a single ring polygon must be smaller than a hemisphere (optional)\n              simple &&\n              geoArea({ type: \"Polygon\", coordinates: [ring] }) > 2 * Math.PI\n        ) {\n          ring.reverse();\n        }\n\n        this.stream.lineStart();\n        ring.pop();\n        for (const [x, y] of ring) this.stream.point(x, y);\n        this.stream.lineEnd();\n      }\n      this.stream.polygonEnd();\n      polygon = null;\n    },\n  });\n}\n\n// The function below creates a shallow clone of the object, passing its coordinates through the projection. It is simpler than d3.geoProject, since it doesn’t try to rewind the projected polygons—and thus is suitable to pass the object through a function that maps spherical coordinates to spherical coordinates.\nconst { geoStream } = d3;\n\nfunction geoProjectSimple(object, projection) {\n  const stream = projection.stream;\n  let project;\n  if (!stream) throw new Error(\"invalid projection\");\n  switch (object && object.type) {\n    case \"Feature\":\n      project = projectFeature;\n      break;\n    case \"FeatureCollection\":\n      project = projectFeatureCollection;\n      break;\n    default:\n      project = projectGeometry;\n      break;\n  }\n  return project(object, stream);\n}\n\nfunction projectFeatureCollection(o, stream) {\n  return { ...o, features: o.features.map((f) => projectFeature(f, stream)) };\n}\n\nfunction projectFeature(o, stream) {\n  return { ...o, geometry: projectGeometry(o.geometry, stream) };\n}\n\nfunction projectGeometryCollection(o, stream) {\n  return {\n    ...o,\n    geometries: o.geometries.map((o) => projectGeometry(o, stream)),\n  };\n}\n\nfunction projectGeometry(o, stream) {\n  return !o\n    ? null\n    : o.type === \"GeometryCollection\"\n    ? projectGeometryCollection(o, stream)\n    : o.type === \"Polygon\" || o.type === \"MultiPolygon\"\n    ? projectPolygons(o, stream)\n    : o;\n}\n\nfunction projectPolygons(o, stream) {\n  let coordinates = [];\n  let polygon, line;\n  geoStream(\n    o,\n    stream({\n      polygonStart() {\n        coordinates.push((polygon = []));\n      },\n      polygonEnd() {},\n      lineStart() {\n        polygon.push((line = []));\n      },\n      lineEnd() {\n        line.push(line[0].slice());\n      },\n      point(x, y) {\n        line.push([x, y]);\n      },\n    })\n  );\n  if (o.type === \"Polygon\") coordinates = coordinates[0];\n  return { ...o, coordinates, rewind: true };\n}\n"],"names":["SegmentControl","props","data","setActiveCategory","activeCategory","_jsx","style","display","flexDirection","children","map","c","i","className","length","onClick","width","height","containerRef","useRef","useState","setData","dataUnitedConsumptionSalaryCategories","filter","elem","category","chartContainerWidth","setChartContainerWidth","categories","useEffect","plot","Plot","subtitle","inset","x","tickFormat","d","compactNumber","toLocaleString","label","labelOffset","y","ticks","marks","stroke","salaryDiffPercent","consDiffPercent","channels","territory_name","value","region_name","consDiff","Math","round","salaryDiff","tip","format","current","append","remove","element","resizeObserver","ResizeObserver","entries","entry","contentRect","observe","disconnect","_jsxs","alignItems","rowGap","Select","ref","defaultValue","onChange","e","target","n","Intl","NumberFormat","notation","geoStream","d3"],"sourceRoot":""}